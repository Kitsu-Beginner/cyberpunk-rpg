<!DOCTYPE html>
<html>
<head>
  {% include "partials/head.html" %}
</head>

<body>

  <h1>Tactical Cyberpunk RPG Project</h1>

  {% include "partials/nav.html" %}
  {% include "partials/item_modal.html" %}
  {% include "partials/character_modal.html" %}
  {% include "partials/level_modal.html" %}

  <main id="content-display">

    <div id="content-home" class="content-block visible">
      <h2>Welcome!</h2>
      <p>Click Rules</p>
    </div>

    {% include "sections/general_rules.html" %}
    {% include "sections/combat.html" %}
    {% include "sections/stats.html" %}
    {% include "sections/magic.html" %}
    {% include "sections/lists.html" %}
    {% include "sections/characters_all.html" %}
    {% include "sections/characters_user.html" %}
    {% include "sections/Timeline.html" %}
   


  </main>

  <!-- NAVIGATION / HIGHLIGHT SCRIPT -->
  <script>
    // Find all <a> links inside the nav
    document.querySelectorAll('nav a[data-shows], nav a[data-toggles]').forEach(link => {


      link.addEventListener('click', (event) => {
        event.preventDefault(); // Stop the link from navigating

        const clickedLink = event.currentTarget;
        const parentBar = clickedLink.closest('ul[data-level]');
        if (!parentBar) return;

        const parentLevel = parseInt(parentBar.dataset.level, 10);
        const toggledBarId = clickedLink.dataset.toggles || null;
        const contentIdToShow = clickedLink.dataset.shows || null;

        // --- MENU BAR LOGIC (show/hide sub bars) ---
        if (toggledBarId) {
          const barToToggle = document.getElementById(toggledBarId);
          if (barToToggle) {
            const barLevel = parseInt(barToToggle.dataset.level, 10);
            const isVisible = barToToggle.classList.contains('visible');

            // Hide all visible bars at this level or deeper
            document.querySelectorAll('nav ul.sub-bar.visible').forEach(visibleBar => {
              const visibleLevel = parseInt(visibleBar.dataset.level, 10);
              if (visibleLevel >= barLevel) {
                visibleBar.classList.remove('visible');
              }
            });

            // Toggle the requested bar
            if (!isVisible) {
              barToToggle.classList.add('visible');
            }
          }
        } else {
          // No toggled bar: hide bars deeper than the current level
          document.querySelectorAll('nav ul.sub-bar.visible').forEach(visibleBar => {
            const visibleLevel = parseInt(visibleBar.dataset.level, 10);
            if (visibleLevel > parentLevel) {
              visibleBar.classList.remove('visible');
            }
          });
        }

        // --- CONTENT LOGIC (show/hide content blocks) ---
        if (contentIdToShow) {
          // Hide all visible content blocks
          document.querySelectorAll('.content-block.visible').forEach(block => {
            block.classList.remove('visible');
          });

          // Show the target block
          const contentToShow = document.getElementById(contentIdToShow);
          if (contentToShow) {
            contentToShow.classList.add('visible');
          }
        }

        // --- HIGHLIGHT LOGIC (parent chain) ---
        // 1. Clear all previous highlights
        document.querySelectorAll('nav li').forEach(li => li.classList.remove('active'));

        // 2. Highlight the clicked item itself
        if (clickedLink.parentElement) {
          clickedLink.parentElement.classList.add('active');
        }

        // 3. Walk "up" the menu hierarchy and highlight parents
        let barEl = parentBar;
        while (barEl) {
          const level = parseInt(barEl.dataset.level, 10);
          if (isNaN(level) || level <= 1) {
            // Level 1 is the top (main bar), we stop after this
            break;
          }

          // Find the link that toggles this bar
          const toggleLink = document.querySelector(
            'nav a[data-toggles="' + barEl.id + '"]'
          );

          if (toggleLink && toggleLink.parentElement) {
            toggleLink.parentElement.classList.add('active');
            // Move one level up: the bar where this toggleLink lives
            barEl = toggleLink.closest('ul[data-level]');
          } else {
            break;
          }
        }

      });
    });
  </script>

  <!-- WEAPONS TABLE (PISTOLS / SMG / etc.) -->
  

  <script src="{{ url_for('static', filename='js/list_items.js') }}"></script>

  <!-- ⬇️ load the modal JS here, after everything else -->
   
  <script src="{{ url_for('static', filename='js/item_view_modal.js') }}"></script>

  <script src="{{ url_for('static', filename='js/characters.js') }}"></script>

  <script src="{{ url_for('static', filename='js/character_modal.js') }}"></script>

  <script src="{{ url_for('static', filename='js/level_modal.js') }}"></script>

  <script src="{{ url_for('static', filename='js/level_skills.js') }}"></script>

  <script src="{{ url_for('static', filename='js/level_shop.js') }}"></script>

  


</body>
</html>
